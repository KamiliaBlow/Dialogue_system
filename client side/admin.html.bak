<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ - –¢–µ—Ä–º–∏–Ω–∞–ª GMS-4521</title>
    <link href="https://fonts.googleapis.com/css?family=Orbitron:700" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @font-face {
            font-family: 'TeletactileRus';
            src: url('TeletactileRus.ttf') format('opentype');
        }

        body {
            margin: 0;
            padding: 0;
            background-color: #000;
            font-family: 'Orbitron', sans-serif;
            color: #03FB8D;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        .container {
            width: 90%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .admin-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 0;
            border-bottom: 1px solid #03FB8D;
            margin-bottom: 30px;
        }

        .admin-title {
            font-size: 24px;
            font-weight: bold;
        }

        .admin-logout {
            background-color: #000;
            border: 1px solid #03FB8D;
            color: #03FB8D;
            padding: 8px 15px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .admin-logout:hover {
            background-color: #03FB8D;
            color: #000;
        }

        .admin-tabs {
            display: flex;
            margin-bottom: 30px;
            border-bottom: 1px solid #03FB8D;
        }

        .admin-tab {
            padding: 10px 20px;
            cursor: pointer;
            transition: all 0.3s;
            background-color: transparent;
            border: none;
            color: #03FB8D;
            font-family: 'Orbitron', sans-serif;
            position: relative;
            margin-right: 5px;
        }

        .admin-tab:hover {
            background-color: rgba(3, 251, 141, 0.1);
        }

        .admin-tab.active {
            color: #000;
            background-color: #03FB8D;
        }

        .admin-tab.active::after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 0;
            width: 100%;
            height: 2px;
            background-color: #03FB8D;
        }

        .admin-content {
            padding: 20px 0;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .admin-card {
            background-color: rgba(0, 0, 0, 0.7);
            border: 1px solid #03FB8D;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 0 10px rgba(3, 251, 141, 0.2);
        }

        .admin-card-title {
            font-size: 18px;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(3, 251, 141, 0.3);
        }

        .user-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }

        .user-table th,
        .user-table td {
            border: 1px solid rgba(3, 251, 141, 0.3);
            padding: 10px;
            text-align: left;
        }

        .user-table th {
            background-color: rgba(3, 251, 141, 0.1);
        }

        .user-table tr:hover {
            background-color: rgba(3, 251, 141, 0.05);
        }

        .btn {
            background-color: #000;
            border: 1px solid #03FB8D;
            color: #03FB8D;
            padding: 6px 12px;
            cursor: pointer;
            font-family: 'Orbitron', sans-serif;
            transition: all 0.3s;
            margin-right: 5px;
        }

        .btn:hover {
            background-color: #03FB8D;
            color: #000;
        }

        .btn-danger {
            border-color: #ff3333;
            color: #ff3333;
        }

        .btn-danger:hover {
            background-color: #ff3333;
            color: #000;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: #000;
            border: 1px solid #03FB8D;
            width: 90%;
            max-width: 400px;
            padding: 20px;
            box-shadow: 0 0 20px rgba(3, 251, 141, 0.3);
        }

        .modal-title {
            font-size: 20px;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(3, 251, 141, 0.3);
        }

        .modal-body {
            margin-bottom: 20px;
        }

        .modal-actions {
            display: flex;
            justify-content: flex-end;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-label {
            display: block;
            margin-bottom: 5px;
        }

        .form-input {
            width: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            border: 1px solid #03FB8D;
            color: #03FB8D;
            padding: 8px;
            font-family: 'TeletactileRus', monospace;
        }

        .chart-container {
            position: relative;
            height: 300px;
            margin-bottom: 20px;
        }

        .statistic-card {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            margin-bottom: 15px;
            background-color: rgba(3, 251, 141, 0.1);
            border-left: 3px solid #03FB8D;
        }

        .statistic-value {
            font-size: 24px;
            font-weight: bold;
        }

        .statistic-label {
            font-size: 14px;
            opacity: 0.8;
        }

        .statistic-icon {
            font-size: 30px;
            opacity: 0.5;
        }

        .choice-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .choice-item {
            padding: 10px;
            margin-bottom: 10px;
            background-color: rgba(3, 251, 141, 0.05);
            border-left: 3px solid rgba(3, 251, 141, 0.5);
            cursor: pointer;
            transition: all 0.3s;
        }

        .choice-item:hover {
            background-color: rgba(3, 251, 141, 0.1);
            border-left-color: #03FB8D;
        }

        .choice-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 5px;
        }

        .choice-title {
            font-weight: bold;
        }

        .choice-count {
            background-color: rgba(3, 251, 141, 0.2);
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 12px;
        }

        .choice-options {
            padding-left: 10px;
            margin-top: 10px;
            display: none;
        }

        .choice-option {
            padding: 5px;
            margin-bottom: 5px;
            display: flex;
            justify-content: space-between;
        }

        .choice-option-text {
            flex: 1;
        }

        .choice-option-count {
            margin-left: 10px;
        }

        .choice-option-percent {
            width: 70px;
            text-align: right;
        }

        .progress-bar {
            height: 5px;
            margin-top: 5px;
            background-color: rgba(3, 251, 141, 0.1);
        }

        .progress-value {
            height: 100%;
            background-color: #03FB8D;
        }

        .expanded .choice-options {
            display: block;
        }

        @media (max-width: 768px) {
            .admin-tabs {
                flex-direction: column;
            }

            .admin-tab {
                width: 100%;
                margin-bottom: 5px;
                margin-right: 0;
            }

            .admin-header {
                flex-direction: column;
                text-align: center;
            }

            .admin-logout {
                margin-top: 10px;
            }

            .statistic-card {
                flex-direction: column;
                text-align: center;
            }

            .statistic-value {
                margin-bottom: 5px;
            }

            .user-table {
                font-size: 12px;
            }

            .btn {
                padding: 4px 8px;
                font-size: 12px;
            }
        }

        /* –ê–Ω–∏–º–∞—Ü–∏—è –¥–ª—è —Ñ–æ–Ω–∞, –∫–∞–∫ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –≤—Ö–æ–¥–∞ */
        .background-code {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0.15;
            z-index: -1;
            overflow: hidden;
            font-family: monospace;
            color: #03FB8D;
            font-size: 14px;
        }

        .code-line {
            position: absolute;
            animation: fallDown 10s linear infinite;
        }

        @keyframes fallDown {
            0% {
                transform: translateY(-100%);
            }

            100% {
                transform: translateY(100vh);
            }
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –ø–æ–ª–∑—É–Ω–∫–∞ –≤–≤–æ–¥–∞ */
        input[type="range"] {
            -webkit-appearance: none;
            width: 100%;
            height: 10px;
            background: rgba(3, 251, 141, 0.1);
            outline: none;
            margin: 10px 0;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: #03FB8D;
            cursor: pointer;
        }

        /* –°—Ç–∏–ª—å –¥–ª—è —Å–æ–æ–±—â–µ–Ω–∏–π */
        .alert {
            padding: 10px 15px;
            margin-bottom: 15px;
            border: 1px solid transparent;
        }

        .alert-success {
            background-color: rgba(0, 128, 0, 0.1);
            border-color: rgba(0, 128, 0, 0.3);
            color: #00ff00;
        }

        .alert-danger {
            background-color: rgba(255, 0, 0, 0.1);
            border-color: rgba(255, 0, 0, 0.3);
            color: #ff3333;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –≤–∫–ª–∞–¥–æ–∫ –¥–µ—Ç–∞–ª—å–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ */
        .sub-tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid rgba(3, 251, 141, 0.3);
        }

        .sub-tab {
            padding: 5px 15px;
            cursor: pointer;
            background-color: transparent;
            color: #03FB8D;
            border: none;
            font-family: 'Orbitron', sans-serif;
        }

        .sub-tab.active {
            background-color: rgba(3, 251, 141, 0.1);
            border-bottom: 2px solid #03FB8D;
        }

        /* Loading indicator */
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100px;
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(3, 251, 141, 0.1);
            border-top: 4px solid #03FB8D;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        /* –ü–∞–≥–∏–Ω–∞—Ü–∏—è */
        .pagination {
            display: flex;
            justify-content: center;
            margin-top: 20px;
        }

        .pagination-button {
            background-color: transparent;
            border: 1px solid #03FB8D;
            color: #03FB8D;
            padding: 5px 10px;
            margin: 0 5px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .pagination-button:hover {
            background-color: rgba(3, 251, 141, 0.1);
        }

        .pagination-button.active {
            background-color: #03FB8D;
            color: #000;
        }

        .pagination-button.disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –ø–æ–∏—Å–∫–∞ */
        .search-container {
            margin-bottom: 20px;
        }

        .search-input {
            width: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            border: 1px solid #03FB8D;
            color: #03FB8D;
            padding: 8px;
            font-family: 'TeletactileRus', monospace;
        }
    </style>
</head>

<body>
    <div class="background-code" id="bgCode"></div>
    <div class="container">
        <div class="admin-header">
            <div class="admin-title">
                –¢–ï–†–ú–ò–ù–ê–õ GMS-4521 - –ü–ê–ù–ï–õ–¨ –ê–î–ú–ò–ù–ò–°–¢–†–ê–¢–û–†–ê
            </div>
            <button id="logout-btn" class="admin-logout">–í–´–•–û–î</button>
        </div>
        <div class="admin-tabs">
            <button class="admin-tab active" data-tab="statistics">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</button> <button class="admin-tab" data-tab="users">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</button> <button class="admin-tab" data-tab="choices">–í—ã–±–æ—Ä—ã</button> <button class="admin-tab" data-tab="progress">–ü—Ä–æ–≥—Ä–µ—Å—Å –¥–∏–∞–ª–æ–≥–æ–≤</button>
        </div>
        <div class="admin-content">
            <div id="statistics" class="tab-content active">
                <div class="admin-card">
                    <div class="admin-card-title">
                        –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
                    </div>
                    <div id="statistics-loading" class="loading">
                        <div class="loading-spinner"></div>
                    </div>
                    <div id="statistics-content" style="display: none;">
                        <div class="row">
                            <div class="col">
                                <div class="statistic-card">
                                    <div>
                                        <div class="statistic-value" id="total-users">
                                            0
                                        </div>
                                        <div class="statistic-label">
                                            –í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
                                        </div>
                                    </div>
                                    <div class="statistic-icon">
                                        üë§
                                    </div>
                                </div>
                            </div>
                            <div class="col">
                                <div class="statistic-card">
                                    <div>
                                        <div class="statistic-value" id="total-choices">
                                            0
                                        </div>
                                        <div class="statistic-label">
                                            –í—Å–µ–≥–æ –≤—ã–±–æ—Ä–æ–≤
                                        </div>
                                    </div>
                                    <div class="statistic-icon">
                                        üîÑ
                                    </div>
                                </div>
                            </div>
                            <div class="col">
                                <div class="statistic-card">
                                    <div>
                                        <div class="statistic-value" id="completed-dialogues">
                                            0
                                        </div>
                                        <div class="statistic-label">
                                            –ó–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö –¥–∏–∞–ª–æ–≥–æ–≤
                                        </div>
                                    </div>
                                    <div class="statistic-icon">
                                        ‚úÖ
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="admin-card">
                    <div class="admin-card-title">
                        –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≤—ã–±–æ—Ä–æ–≤ –ø–æ —á–∞—Å—Ç–æ—Ç–∞–º
                    </div>
                    <div class="chart-container">
                        <canvas id="frequency-chart"></canvas>
                    </div>
                </div>
                <div class="admin-card">
                    <div class="admin-card-title">
                        –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –≤—ã–±–æ—Ä—ã
                    </div>
                    <div class="chart-container">
                        <canvas id="choices-chart"></canvas>
                    </div>
                </div>
            </div>
            <div id="users" class="tab-content">
                <div class="admin-card">
                    <div class="admin-card-title">
                        –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
                    </div>
                    <div class="search-container">
                        <input type="text" id="user-search" class="search-input" placeholder="–ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è...">
                    </div>
                    <div id="users-loading" class="loading">
                        <div class="loading-spinner"></div>
                    </div>
                    <table class="user-table" id="users-table" style="display: none;">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>–ü–æ–∑—ã–≤–Ω–æ–π</th>
                                <th>–î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏</th>
                                <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                            </tr>
                        </thead>
                        <tbody id="users-table-body"></tbody>
                    </table>
                    <div class="pagination" id="users-pagination"></div>
                </div>
            </div>
            <div id="choices" class="tab-content">
                <div class="admin-card">
                    <div class="admin-card-title">
                        –í—ã–±–æ—Ä—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
                    </div>
                    <div class="sub-tabs">
                    </div>
                    <div id="choices-loading" class="loading">
                        <div class="loading-spinner"></div>
                    </div>
                    <div id="choices-content" style="display: none;">
                        <ul class="choice-list" id="choice-list"></ul>
                    </div>
                </div>
            </div>
            <div id="progress" class="tab-content">
                <div class="admin-card">
                    <div class="admin-card-title">
                        –ü—Ä–æ–≥—Ä–µ—Å—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ –¥–∏–∞–ª–æ–≥–∞—Ö
                    </div>
                    <div id="progress-loading" class="loading">
                        <div class="loading-spinner"></div>
                    </div>
                    <div id="progress-content" style="display: none;">
                        <div class="chart-container">
                            <canvas id="progress-chart"></canvas>
                        </div>
                        <table class="user-table">
                            <thead>
                                <tr>
                                    <th>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</th>
                                    <th>–ß–∞—Å—Ç–æ—Ç–∞</th>
                                    <th>–ü—Ä–æ–≥—Ä–µ—Å—Å</th>
                                    <th>–ó–∞–≤–µ—Ä—à–µ–Ω</th>
                                </tr>
                            </thead>
                            <tbody id="progress-table-body"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div id="password-modal" class="modal">
        <div class="modal-content">
            <div class="modal-title">
                –ò–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å
            </div>
            <div class="modal-body">
                <form id="change-password-form" name="change-password-form">
                    <input type="hidden" id="user-id-input">
                    <div class="form-group">
                        <label class="form-label">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:</label>
                        <div id="modal-username"></div>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="new-password">–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å:</label> <input type="password" id="new-password" class="form-input" required="" minlength="6">
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="confirm-password">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å:</label> <input type="password" id="confirm-password" class="form-input" required="" minlength="6">
                    </div>
                    <div id="password-error" class="alert alert-danger" style="display: none;"></div>
                </form>
            </div>
            <div class="modal-actions">
                <button id="cancel-password" class="btn">–û—Ç–º–µ–Ω–∞</button> <button id="save-password" class="btn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            </div>
        </div>
    </div>
    <div id="choice-details-modal" class="modal">
        <div class="modal-content">
            <div class="modal-title">
                –î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è –≤—ã–±–æ—Ä–∞
            </div>
            <div class="modal-body">
                <div id="choice-details-loading" class="loading">
                    <div class="loading-spinner"></div>
                </div>
                <div id="choice-details-content" style="display: none;">
                    <div class="form-group">
                        <label class="form-label">–ß–∞—Å—Ç–æ—Ç–∞:</label>
                        <div id="detail-frequency"></div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">ID –≤—ã–±–æ—Ä–∞:</label>
                        <div id="detail-choice-id"></div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">–í–∞—Ä–∏–∞–Ω—Ç—ã –æ—Ç–≤–µ—Ç–æ–≤:</label>
                        <div id="detail-options"></div>
                    </div>
                    <div class="chart-container">
                        <canvas id="detail-chart"></canvas>
                    </div>
                    <div class="form-group">
                        <label class="form-label">–°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:</label>
                        <table class="user-table">
                            <thead>
                                <tr>
                                    <th>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</th>
                                    <th>–í–∞—Ä–∏–∞–Ω—Ç</th>
                                    <th>–î–∞—Ç–∞ –≤—ã–±–æ—Ä–∞</th>
                                </tr>
                            </thead>
                            <tbody id="detail-users-table"></tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div class="modal-actions">
                <button id="close-details" class="btn">–ó–∞–∫—Ä—ã—Ç—å</button>
            </div>
        </div>
    </div>
    <script>
        // –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã const 
        API_URL = 'https://yousite:3000/api';
        const ITEMS_PER_PAGE = 10;

        // –°–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        const state = {
            users: [],
            currentUserPage: 1,
            totalUserPages: 1,
            choiceStats: [],
            currentFrequency: 'all',
            progressData: [],
            charts: {},
            frequencies: [] // –ù–æ–≤–æ–µ —Å–≤–æ–π—Å—Ç–≤–æ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —á–∞—Å—Ç–æ—Ç
        };

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ DOM –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –∏ –ø—Ä–∞–≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
                const authResponse = await fetch(`${API_URL}/admin/check`, {
                    credentials: 'include',
                    // –î–æ–±–∞–≤–∏–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è
                    headers: {
                        'Cache-Control': 'no-cache, no-store, must-revalidate',
                        'Pragma': 'no-cache',
                        'Expires': '0',
                    }
                });

                if (!authResponse.ok) {
                    // –ï—Å–ª–∏ –∑–∞–ø—Ä–æ—Å –∑–∞–≤–µ—Ä—à–∏–ª—Å—è —Å –æ—à–∏–±–∫–æ–π, –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤—Ö–æ–¥–∞
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:', authResponse.status);
                    window.location.href = 'index.html';
                    return;
                }

                const authData = await authResponse.json();

                if (!authData.isAdmin) {
                    console.error('–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º');
                    // –î–æ–±–∞–≤–ª—è–µ–º –Ω–µ–±–æ–ª—å—à—É—é –∑–∞–¥–µ—Ä–∂–∫—É –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º
                    setTimeout(() => {
                        window.location.href = 'index.html';
                    }, 100);
                    return;
                }

                console.log('–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–π –¥–æ—Å—Ç—É–ø –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω');

                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤–∫–ª–∞–¥–æ–∫
                initializeTabs();

                // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –ø–µ—Ä–≤–æ–π –∞–∫—Ç–∏–≤–Ω–æ–π –≤–∫–ª–∞–¥–∫–∏ (—Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞)
                loadStatisticsData();

                // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –¥–ª—è –∫–Ω–æ–ø–∫–∏ –≤—ã—Ö–æ–¥–∞
                document.getElementById('logout-btn').addEventListener('click', logout);

                // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω
                initializeModals();

                // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ñ–æ–Ω–æ–≤–æ–≥–æ –∫–æ–¥–∞
                generateBackgroundCode();
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ø–∞–Ω–µ–ª–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞:', error);
                alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –ø–∞–Ω–µ–ª–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞. –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É...');
                window.location.href = 'index.html';
            }
        });

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤–∫–ª–∞–¥–æ–∫
        function initializeTabs() {
            const tabButtons = document.querySelectorAll('.admin-tab');
            const tabContents = document.querySelectorAll('.tab-content');

            tabButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const tabName = button.getAttribute('data-tab');

                    // –°–Ω–∞—á–∞–ª–∞ —É–¥–∞–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —É –≤—Å–µ—Ö –≤–∫–ª–∞–¥–æ–∫
                    tabButtons.forEach(btn => btn.classList.remove('active'));
                    tabContents.forEach(content => content.classList.remove('active'));

                    // –î–æ–±–∞–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å –Ω—É–∂–Ω–æ–π –≤–∫–ª–∞–¥–∫–µ
                    button.classList.add('active');
                    document.getElementById(tabName).classList.add('active');

                    // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∞–∫—Ç–∏–≤–Ω–æ–π –≤–∫–ª–∞–¥–∫–∏
                    switch (tabName) {
                        case 'statistics':
                            loadStatisticsData();
                            break;
                        case 'users':
                            loadUsersData();
                            break;
                        case 'choices':
                            // –ï—Å–ª–∏ –ø–µ—Ä–µ—à–ª–∏ –Ω–∞ –≤–∫–ª–∞–¥–∫—É –≤—ã–±–æ—Ä–æ–≤, –∑–∞–≥—Ä—É–∂–∞–µ–º —á–∞—Å—Ç–æ—Ç—ã –∏ –æ–±–Ω–æ–≤–ª—è–µ–º –ø–æ–¥–≤–∫–ª–∞–¥–∫–∏
                            updateFrequencyTabs().then(() => loadChoicesData());
                            break;
                        case 'progress':
                            loadProgressData();
                            break;
                    }
                });
            });
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω
        function initializeModals() {
            // –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å–º–µ–Ω—ã –ø–∞—Ä–æ–ª—è
            const passwordModal = document.getElementById('password-modal');

            document.getElementById('cancel-password').addEventListener('click', () => {
                passwordModal.style.display = 'none';
            });

            document.getElementById('save-password').addEventListener('click', changeUserPassword);

            // –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏ –≤—ã–±–æ—Ä–∞
            const choiceDetailsModal = document.getElementById('choice-details-modal');

            document.getElementById('close-details').addEventListener('click', () => {
                choiceDetailsModal.style.display = 'none';
            });

            // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ
            window.addEventListener('click', (event) => {
                if (event.target === passwordModal) {
                    passwordModal.style.display = 'none';
                }
                if (event.target === choiceDetailsModal) {
                    choiceDetailsModal.style.display = 'none';
                }
            });
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        async function loadStatisticsData() {
            showLoading('statistics');

            try {
                // –ú–∞—Å—Å–∏–≤ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∑–∞–ø—Ä–æ—Å–æ–≤
                const results = {
                    users: null,
                    choices: null,
                    progress: null
                };

                // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è—Ö
                try {
                    results.users = await safeFetch(`${API_URL}/admin/users`);
                    if (results.users && results.users.users && Array.isArray(results.users.users)) {
                        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
                        document.getElementById('total-users').textContent = results.users.users.length;
                    }
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –¥–∞–Ω–Ω—ã—Ö –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è—Ö:', error);
                }

                // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –æ –≤—ã–±–æ—Ä–∞—Ö
                try {
                    results.choices = await safeFetch(`${API_URL}/admin/choice-statistics`);
                    if (results.choices && results.choices.statistics && Array.isArray(results.choices.statistics)) {
                        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–∞ –≤—ã–±–æ—Ä–æ–≤
                        document.getElementById('total-choices').textContent = results.choices.statistics.length;

                        // –°–æ–∑–¥–∞–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–æ–≤
                        if (results.choices.statistics.length > 0) {
                            createFrequencyChart(results.choices.statistics);
                            createChoicesChart(results.choices.statistics);
                        }
                    }
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –¥–∞–Ω–Ω—ã—Ö –æ –≤—ã–±–æ—Ä–∞—Ö:', error);
                    document.getElementById('frequency-chart').innerHTML = '<div class="no-data">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è';
                    document.getElementById('choices-chart').innerHTML = '<div class="no-data">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è';
                }

                // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –æ –ø—Ä–æ–≥—Ä–µ—Å—Å–µ
                try {
                    results.progress = await safeFetch(`${API_URL}/admin/user-progress`);
                    if (results.progress && results.progress.progress && Array.isArray(results.progress.progress)) {
                        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö –¥–∏–∞–ª–æ–≥–æ–≤
                        const completedDialogues = results.progress.progress.filter(p => p.completed).length;
                        document.getElementById('completed-dialogues').textContent = completedDialogues;
                    }
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –¥–∞–Ω–Ω—ã—Ö –æ –ø—Ä–æ–≥—Ä–µ—Å—Å–µ:', error);
                }

                // –ü—Ä–æ–≤–µ—Ä–∫–∞, –ø–æ–ª—É—á–µ–Ω—ã –ª–∏ –∫–∞–∫–∏–µ-–ª–∏–±–æ –¥–∞–Ω–Ω—ã–µ
                if (!results.users && !results.choices && !results.progress) {
                    throw new Error('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –Ω–∏–∫–∞–∫–∏–µ –¥–∞–Ω–Ω—ã–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏');
                }

                // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ
                hideLoading('statistics');

                // –ï—Å–ª–∏ –±—ã–ª–∏ –æ—à–∏–±–∫–∏, –Ω–æ –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—É—á–µ–Ω—ã, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ
                if (!results.users || !results.choices || !results.progress) {
                    const warning = document.createElement('div');
                    warning.className = 'alert alert-warning';
                    warning.textContent = '–ù–µ–∫–æ—Ç–æ—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã. –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–º —Ä–µ–∂–∏–º–µ.';

                    const contentElement = document.getElementById('statistics-content');
                    if (contentElement) {
                        contentElement.insertBefore(warning, contentElement.firstChild);

                        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∫—Ä—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 10 —Å–µ–∫—É–Ω–¥
                        setTimeout(() => {
                            warning.style.display = 'none';
                        }, 10000);
                    }
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:', error);
                hideLoading('statistics');

                const errorMsg = typeof error === 'string' ? error :
                    error.message ? error.message :
                    '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞';

                showErrorMessage('statistics-content', `–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É: ${errorMsg}`);

                // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –ø—É—Å—Ç—ã–µ –≥—Ä–∞—Ñ–∏–∫–∏
                document.getElementById('frequency-chart').innerHTML = '<div class="no-data">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è';
                document.getElementById('choices-chart').innerHTML = '<div class="no-data">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è';
            }
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–∞ –ø–æ —á–∞—Å—Ç–æ—Ç–∞–º
        function createFrequencyChart(statistics) {
            const frequencyData = {};

            // –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ —á–∞—Å—Ç–æ—Ç–∞–º
            statistics.forEach(stat => {
                if (!frequencyData[stat.frequency]) {
                    frequencyData[stat.frequency] = 0;
                }
                frequencyData[stat.frequency] += parseInt(stat.count);
            });

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –¥–∞–Ω–Ω—ã–µ
            if (Object.keys(frequencyData).length === 0) {
                console.warn('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≥—Ä–∞—Ñ–∏–∫–∞ —á–∞—Å—Ç–æ—Ç');
                document.getElementById('frequency-chart').innerHTML = '<div class="no-data">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è';
                return;
            }

            // –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–∞
            const labels = Object.keys(frequencyData);
            const data = Object.values(frequencyData);

            // –°–æ–∑–¥–∞–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–∞
            const ctx = document.getElementById('frequency-chart').getContext('2d');

            if (state.charts.frequencyChart) {
                state.charts.frequencyChart.destroy();
            }

            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –±–æ–ª—å—à–µ —Ü–≤–µ—Ç–æ–≤ –¥–ª—è –≤–æ–∑–º–æ–∂–Ω—ã—Ö –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö —á–∞—Å—Ç–æ—Ç
            const colors = generateColorsForFrequencies(labels.length);

            state.charts.frequencyChart = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: labels,
                    datasets: [{
                        data: data,
                        backgroundColor: colors.backgroundColors,
                        borderColor: colors.borderColors,
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                color: '#03FB8D'
                            }
                        },
                        title: {
                            display: true,
                            text: '–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≤—ã–±–æ—Ä–æ–≤ –ø–æ —á–∞—Å—Ç–æ—Ç–∞–º',
                            color: '#03FB8D'
                        }
                    }
                }
            });
        }

        /**
         * –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ü–≤–µ—Ç–æ–≤ –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–∞ —á–∞—Å—Ç–æ—Ç
         * @param {number} count - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç—Ä–µ–±—É–µ–º—ã—Ö —Ü–≤–µ—Ç–æ–≤
         * @returns {Object} –û–±—ä–µ–∫—Ç —Å –º–∞—Å—Å–∏–≤–∞–º–∏ —Ü–≤–µ—Ç–æ–≤ –¥–ª—è —Ñ–æ–Ω–∞ –∏ –≥—Ä–∞–Ω–∏—Ü
         */
        function generateColorsForFrequencies(count) {
            const backgroundColors = [];
            const borderColors = [];

            // –ë–∞–∑–æ–≤—ã–µ —Ü–≤–µ—Ç–∞ –¥–ª—è –ø–µ—Ä–≤—ã—Ö —Ç—Ä–µ—Ö —á–∞—Å—Ç–æ—Ç
            const baseColors = [
                'rgba(3, 251, 141, 0.7)',
                'rgba(75, 192, 192, 0.7)',
                'rgba(153, 102, 255, 0.7)'
            ];

            const baseBorderColors = [
                'rgba(3, 251, 141, 1)',
                'rgba(75, 192, 192, 1)',
                'rgba(153, 102, 255, 1)'
            ];

            // –î–æ–±–∞–≤–ª—è–µ–º –±–∞–∑–æ–≤—ã–µ —Ü–≤–µ—Ç–∞
            for (let i = 0; i < Math.min(count, baseColors.length); i++) {
                backgroundColors.push(baseColors[i]);
                borderColors.push(baseBorderColors[i]);
            }

            // –ï—Å–ª–∏ –Ω—É–∂–Ω–æ –±–æ–ª—å—à–µ —Ü–≤–µ—Ç–æ–≤, –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∏—Ö
            if (count > baseColors.length) {
                for (let i = baseColors.length; i < count; i++) {
                    // –ò—Å–ø–æ–ª—å–∑—É–µ–º –∑–æ–ª–æ—Ç–æ–µ —Å–µ—á–µ–Ω–∏–µ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ä–∞–∑–Ω—ã—Ö –æ—Ç—Ç–µ–Ω–∫–æ–≤
                    const hue = (i * 137.5) % 360;
                    backgroundColors.push(`hsla(${hue}, 70%, 60%, 0.7)`);
                    borderColors.push(`hsla(${hue}, 70%, 60%, 1)`);
                }
            }

            return {
                backgroundColors,
                borderColors
            };
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–∞ –ø–æ –ø–æ–ø—É–ª—è—Ä–Ω—ã–º –≤—ã–±–æ—Ä–∞–º
        function createChoicesChart(statistics) {
            // –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –≤—ã–±–æ—Ä–æ–≤ –ø–æ choiceId
            const choiceGroups = {};
            statistics.forEach(stat => {
                const key = `${stat.frequency}-${stat.choice_id}`;
                if (!choiceGroups[key]) {
                    choiceGroups[key] = {
                        label: `${stat.frequency}: ${stat.choice_id}`,
                        total: 0,
                        options: {}
                    };
                }

                choiceGroups[key].total += parseInt(stat.count);
                choiceGroups[key].options[stat.option_id] = {
                    text: stat.choice_text,
                    count: parseInt(stat.count)
                };
            });

            // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤ –º–∞—Å—Å–∏–≤ –∏ —Å–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –æ–±—â–µ–º—É –∫–æ–ª–∏—á–µ—Å—Ç–≤—É
            const sortedChoices = Object.values(choiceGroups).sort((a, b) => b.total - a.total);

            // –ë–µ—Ä–µ–º —Ç–æ–ª—å–∫–æ —Ç–æ–ø-5 —Å–∞–º—ã—Ö –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –≤—ã–±–æ—Ä–æ–≤
            const topChoices = sortedChoices.slice(0, 5);

            // –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–∞
            const datasets = [];
            const colors = [
                'rgba(3, 251, 141, 0.7)',
                'rgba(75, 192, 192, 0.7)',
                'rgba(153, 102, 255, 0.7)',
                'rgba(255, 159, 64, 0.7)',
                'rgba(255, 99, 132, 0.7)'
            ];

            topChoices.forEach((choice, index) => {
                const data = [];
                const labels = [];

                // –§–æ—Ä–º–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∫–∞–∂–¥–æ–π –æ–ø—Ü–∏–∏
                Object.entries(choice.options).forEach(([optionId, option]) => {
                    labels.push(optionId);
                    data.push(option.count);
                });

                datasets.push({
                    label: choice.label,
                    data: data,
                    backgroundColor: colors[index % colors.length],
                    borderColor: colors[index % colors.length].replace('0.7', '1'),
                    borderWidth: 1
                });
            });

            // –°–æ–∑–¥–∞–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–∞
            const ctx = document.getElementById('choices-chart').getContext('2d');

            if (state.charts.choicesChart) {
                state.charts.choicesChart.destroy();
            }

            state.charts.choicesChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: topChoices.map(choice => choice.label),
                    datasets: [{
                        label: '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤—ã–±–æ—Ä–æ–≤',
                        data: topChoices.map(choice => choice.total),
                        backgroundColor: colors,
                        borderColor: colors.map(color => color.replace('0.7', '1')),
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        title: {
                            display: true,
                            text: '–¢–æ–ø-5 –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –≤—ã–±–æ—Ä–æ–≤',
                            color: '#03FB8D'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                color: '#03FB8D'
                            },
                            grid: {
                                color: 'rgba(3, 251, 141, 0.1)'
                            }
                        },
                        x: {
                            ticks: {
                                color: '#03FB8D'
                            },
                            grid: {
                                color: 'rgba(3, 251, 141, 0.1)'
                            }
                        }
                    }
                }
            });
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π 
        async function loadUsersData() {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ —ç–ª–µ–º–µ–Ω—Ç –ø–µ—Ä–µ–¥ –ø–æ–∫–∞–∑–æ–º –∑–∞–≥—Ä—É–∑–∫–∏ 
            const loadingElement = document.getElementById('users-loading');
            const tableBody = document.getElementById('users-table-body');
            const usersTable = document.getElementById('users-table');

            if (loadingElement) {
                loadingElement.style.display = 'flex';
            }

            if (usersTable) {
                usersTable.style.display = 'none';
            }

            try {
                const data = await safeFetch(`${API_URL}/admin/users`);

                if (!data || !data.users || !Array.isArray(data.users)) {
                    throw new Error('–ü–æ–ª—É—á–µ–Ω—ã –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è—Ö');
                }

                state.users = data.users;
                state.totalUserPages = Math.ceil(state.users.length / ITEMS_PER_PAGE) || 1;

                renderUsersTable();
                renderUsersPagination();

                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–∏—Å–∫–∞
                const searchInput = document.getElementById('user-search');
                if (searchInput) {
                    searchInput.addEventListener('input', function() {
                        const searchTerm = this.value.toLowerCase();

                        if (searchTerm) {
                            const filteredUsers = state.users.filter(user =>
                                user.username.toLowerCase().includes(searchTerm)
                            );
                            renderUsersTable(filteredUsers);
                        } else {
                            renderUsersTable();
                        }
                    });
                }

                // –°–∫—Ä—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–∞–±–ª–∏—Ü—É
                if (loadingElement) {
                    loadingElement.style.display = 'none';
                }

                if (usersTable) {
                    usersTable.style.display = 'table';
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:', error);

                // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
                state.users = [];
                state.totalUserPages = 1;

                if (loadingElement) {
                    loadingElement.style.display = 'none';
                }

                if (tableBody) {
                    tableBody.innerHTML = '<tr><td colspan="4" class="text-center">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è—Ö. –í–æ–∑–º–æ–∂–Ω–æ, —Å–µ—Ä–≤–µ—Ä –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω.';
                }

                if (usersTable) {
                    usersTable.style.display = 'table';
                }

                showErrorMessage('users', `–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: ${error.message}`);
            }
        }

        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —Ç–∞–±–ª–∏—Ü—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å —É—á–µ—Ç–æ–º –ø–∞–≥–∏–Ω–∞—Ü–∏–∏
        function renderUsersTable(users = null) {
            const tableBody = document.getElementById('users-table-body');
            tableBody.innerHTML = '';

            const usersToRender = users || state.users;

            // –í—ã—á–∏—Å–ª—è–µ–º –Ω–∞—á–∞–ª—å–Ω—ã–π –∏ –∫–æ–Ω–µ—á–Ω—ã–π –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
            const startIndex = (state.currentUserPage - 1) * ITEMS_PER_PAGE;
            const endIndex = Math.min(startIndex + ITEMS_PER_PAGE, usersToRender.length);

            // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Ç–æ–ª—å–∫–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
            const pageUsers = usersToRender.slice(startIndex, endIndex);

            if (pageUsers.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = '<td colspan="4" style="text-align: center;">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã';
                tableBody.appendChild(row);
            } else {
                pageUsers.forEach(user => {
                    const row = document.createElement('tr');

                    // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –¥–∞—Ç—É
                    const createdAt = new Date(user.created_at);
                    const formattedDate = `${createdAt.toLocaleDateString()} ${createdAt.toLocaleTimeString()}`;

                    row.innerHTML = `
         <td>${user.id}
         <td>${user.username}
         <td>${formattedDate}
         <td>
           <button class="btn change-password-btn" data-id="${user.id}" data-username="${user.username}">
             –°–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å
           
         
         `;

                    tableBody.appendChild(row);

                });

                // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ —Å–º–µ–Ω—ã –ø–∞—Ä–æ–ª—è
                document.querySelectorAll('.change-password-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        openPasswordModal(this.getAttribute('data-id'), this.getAttribute('data-username'));
                    });
                });
            }

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–∞–±–ª–∏—Ü—É
            document.getElementById('users-table').style.display = 'table';
        }

        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏ –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
        function renderUsersPagination() {
            const paginationContainer = document.getElementById('users-pagination');
            paginationContainer.innerHTML = '';

            if (state.totalUserPages <= 1) {
                return;
            }

            // –ö–Ω–æ–ø–∫–∞ "–ü—Ä–µ–¥—ã–¥—É—â–∞—è"
            const prevButton = document.createElement('button');
            prevButton.innerHTML = '¬´';
            prevButton.classList.add('pagination-button');
            if (state.currentUserPage === 1) {
                prevButton.classList.add('disabled');
            } else {
                prevButton.addEventListener('click', () => {
                    if (state.currentUserPage > 1) {
                        state.currentUserPage--;
                        renderUsersTable();
                        renderUsersPagination();
                    }
                });
            }
            paginationContainer.appendChild(prevButton);

            // –ö–Ω–æ–ø–∫–∏ —Å –Ω–æ–º–µ—Ä–∞–º–∏ —Å—Ç—Ä–∞–Ω–∏—Ü
            const maxVisiblePages = 5;
            let startPage = Math.max(1, state.currentUserPage - Math.floor(maxVisiblePages / 2));
            let endPage = Math.min(state.totalUserPages, startPage + maxVisiblePages - 1);

            // –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–µ–º startPage, –µ—Å–ª–∏ endPage —Å—Ç–∞–ª –º–µ–Ω—å—à–µ –∏–∑-–∑–∞ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è
            startPage = Math.max(1, endPage - maxVisiblePages + 1);

            for (let i = startPage; i <= endPage; i++) {
                const pageButton = document.createElement('button');
                pageButton.textContent = i;
                pageButton.classList.add('pagination-button');

                if (i === state.currentUserPage) {
                    pageButton.classList.add('active');
                } else {
                    pageButton.addEventListener('click', () => {
                        state.currentUserPage = i;
                        renderUsersTable();
                        renderUsersPagination();
                    });
                }

                paginationContainer.appendChild(pageButton);
            }

            // –ö–Ω–æ–ø–∫–∞ "–°–ª–µ–¥—É—é—â–∞—è"
            const nextButton = document.createElement('button');
            nextButton.innerHTML = '¬ª';
            nextButton.classList.add('pagination-button');

            if (state.currentUserPage === state.totalUserPages) {
                nextButton.classList.add('disabled');
            } else {
                nextButton.addEventListener('click', () => {
                    if (state.currentUserPage < state.totalUserPages) {
                        state.currentUserPage++;
                        renderUsersTable();
                        renderUsersPagination();
                    }
                });
            }
            paginationContainer.appendChild(nextButton);
        }

        // –û—Ç–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –¥–ª—è —Å–º–µ–Ω—ã –ø–∞—Ä–æ–ª—è
        function openPasswordModal(userId, username) {
            document.getElementById('user-id-input').value = userId;
            document.getElementById('modal-username').textContent = username;
            document.getElementById('new-password').value = '';
            document.getElementById('confirm-password').value = '';
            document.getElementById('password-error').style.display = 'none';

            document.getElementById('password-modal').style.display = 'flex';
        }

        // –ò–∑–º–µ–Ω–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        async function changeUserPassword() {
            const userId = document.getElementById('user-id-input').value;
            const newPassword = document.getElementById('new-password').value;
            const confirmPassword = document.getElementById('confirm-password').value;
            const errorElement = document.getElementById('password-error');

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç–∏ –ø–∞—Ä–æ–ª—è
            if (newPassword.length < 6) {
                errorElement.textContent = '–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤';
                errorElement.style.display = 'block';
                return;
            }

            if (newPassword !== confirmPassword) {
                errorElement.textContent = '–ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç';
                errorElement.style.display = 'block';
                return;
            }

            try {
                const response = await fetch(`${API_URL}/admin/change-password`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        userId: userId,
                        newPassword: newPassword
                    }),
                    credentials: 'include'
                });

                const data = await response.json();

                if (!response.ok) {
                    throw new Error(data.message || '–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –ø–∞—Ä–æ–ª—è');
                }

                // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
                document.getElementById('password-modal').style.display = 'none';

                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—à–Ω–æ–º –∏–∑–º–µ–Ω–µ–Ω–∏–∏
                showSuccessMessage('users-table', '–ü–∞—Ä–æ–ª—å —É—Å–ø–µ—à–Ω–æ –∏–∑–º–µ–Ω–µ–Ω');
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –ø–∞—Ä–æ–ª—è:', error);
                errorElement.textContent = error.message || '–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.';
                errorElement.style.display = 'block';
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –æ –≤—ã–±–æ—Ä–∞—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
        // –û–±–Ω–æ–≤–ª—è–µ–º —Ñ—É–Ω–∫—Ü–∏—é –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –æ –≤—ã–±–æ—Ä–∞—Ö
        async function loadChoicesData() {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ —ç–ª–µ–º–µ–Ω—Ç –ø–µ—Ä–µ–¥ –ø–æ–∫–∞–∑–æ–º –∑–∞–≥—Ä—É–∑–∫–∏
            const loadingElement = document.getElementById('choices-loading');
            const contentElement = document.getElementById('choices-content');
            const choiceList = document.getElementById('choice-list');

            if (loadingElement && contentElement) {
                loadingElement.style.display = 'flex';
                contentElement.style.display = 'none';
            }

            try {
                console.log(`–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –æ –≤—ã–±–æ—Ä–∞—Ö –¥–ª—è —á–∞—Å—Ç–æ—Ç—ã: ${state.currentFrequency}`);

                const data = await safeFetch(`${API_URL}/admin/choice-statistics`);

                if (!data || !data.statistics || !Array.isArray(data.statistics)) {
                    throw new Error('–ü–æ–ª—É—á–µ–Ω—ã –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –æ –≤—ã–±–æ—Ä–∞—Ö');
                }

                state.choiceStats = data.statistics;
                console.log(`–í—Å–µ–≥–æ –ø–æ–ª—É—á–µ–Ω–æ –∑–∞–ø–∏—Å–µ–π –æ –≤—ã–±–æ—Ä–∞—Ö: ${state.choiceStats.length}`);

                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å–ª–∏ –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–π —á–∞—Å—Ç–æ—Ç—ã –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö
                const filteredStats = state.currentFrequency === 'all' ?
                    state.choiceStats :
                    state.choiceStats.filter(stat => stat.frequency === state.currentFrequency);

                console.log(`–û—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–æ –∑–∞–ø–∏—Å–µ–π –¥–ª—è —á–∞—Å—Ç–æ—Ç—ã ${state.currentFrequency}: ${filteredStats.length}`);

                renderChoicesList();

                if (loadingElement && contentElement) {
                    loadingElement.style.display = 'none';
                    contentElement.style.display = 'block';
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –≤—ã–±–æ—Ä–æ–≤:', error);

                // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤ –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è –æ—à–∏–±–æ–∫ –≤ –¥—Ä—É–≥–∏—Ö —Ñ—É–Ω–∫—Ü–∏—è—Ö
                state.choiceStats = [];

                if (loadingElement) {
                    loadingElement.style.display = 'none';
                }

                if (contentElement) {
                    contentElement.style.display = 'block';
                }

                if (choiceList) {
                    choiceList.innerHTML = '<li class="choice-item">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ –≤—ã–±–æ—Ä–∞—Ö. –í–æ–∑–º–æ–∂–Ω–æ, —Å–µ—Ä–≤–µ—Ä –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω.';
                }

                showErrorMessage('choices-content', `–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –≤—ã–±–æ—Ä–æ–≤: ${error.message}`);
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏ –ø–∞—Ä—Å–∏–Ω–≥–∞ Config.js
        async function loadFrequenciesFromScript() {
            try {
                // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ Config.js
                const response = await fetch('Config.js');
                if (!response.ok) {
                    throw new Error(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ Config.js: ${response.status}`);
                }

                const scriptContent = await response.text();

                // –ò—â–µ–º –º–∞—Å—Å–∏–≤ frequencies –≤ —Å–∫—Ä–∏–ø—Ç–µ —Å –ø–æ–º–æ—â—å—é —Ä–µ–≥—É–ª—è—Ä–Ω–æ–≥–æ –≤—ã—Ä–∞–∂–µ–Ω–∏—è
                const frequencyMatch = scriptContent.match(/'frequencies':\s*\[(.*?)\]/s);

                if (!frequencyMatch || !frequencyMatch[1]) {
                    console.error('–ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ –º–∞—Å—Å–∏–≤ frequencies –≤ Config.js');
                    return ['145.55', 'PRIV', '???']; // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –º–∞—Å—Å–∏–≤ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤ —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏
                }

                // –ü–∞—Ä—Å–∏–º –º–∞—Å—Å–∏–≤ —á–∞—Å—Ç–æ—Ç
                const frequenciesString = frequencyMatch[1];
                const frequencies = frequenciesString.split(',')
                    .map(item => item.trim().replace(/['"]/g, '')) // –£–±–∏—Ä–∞–µ–º –∫–∞–≤—ã—á–∫–∏ –∏ –ø—Ä–æ–±–µ–ª—ã
                    .filter(item => item); // –§–∏–ª—å—Ç—Ä—É–µ–º –ø—É—Å—Ç—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è

                console.log('–ó–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ —á–∞—Å—Ç–æ—Ç—ã:', frequencies);
                return frequencies;
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —á–∞—Å—Ç–æ—Ç –∏–∑ Config.js:', error);
                return ['145.55', 'PRIV', '???']; // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –º–∞—Å—Å–∏–≤ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤ —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤–∫–ª–∞–¥–æ–∫ —Å —á–∞—Å—Ç–æ—Ç–∞–º–∏
        async function updateFrequencyTabs() {
            try {
                // –ó–∞–≥—Ä—É–∂–∞–µ–º —á–∞—Å—Ç–æ—Ç—ã
                const frequencies = await loadFrequenciesFromScript();

                // –ù–∞—Ö–æ–¥–∏–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å –≤–∫–ª–∞–¥–∫–∞–º–∏ —á–∞—Å—Ç–æ—Ç
                const subTabsContainer = document.querySelector('.sub-tabs');
                if (!subTabsContainer) {
                    console.error('–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –≤–∫–ª–∞–¥–æ–∫ —á–∞—Å—Ç–æ—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω');
                    return;
                }

                // –û—á–∏—â–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
                subTabsContainer.innerHTML = '';

                // –î–æ–±–∞–≤–ª—è–µ–º –≤–∫–ª–∞–¥–∫—É "–í—Å–µ —á–∞—Å—Ç–æ—Ç—ã"
                const allTab = document.createElement('button');
                allTab.className = 'sub-tab active';
                allTab.setAttribute('data-freq', 'all');
                allTab.textContent = '–í—Å–µ —á–∞—Å—Ç–æ—Ç—ã';
                subTabsContainer.appendChild(allTab);

                // –î–æ–±–∞–≤–ª—è–µ–º –≤–∫–ª–∞–¥–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–π —á–∞—Å—Ç–æ—Ç—ã
                frequencies.forEach(frequency => {
                    const tab = document.createElement('button');
                    tab.className = 'sub-tab';
                    tab.setAttribute('data-freq', frequency);
                    tab.textContent = frequency;
                    subTabsContainer.appendChild(tab);
                });

                // –û–±–Ω–æ–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –¥–ª—è –≤–∫–ª–∞–¥–æ–∫
                initializeSubTabs();

                console.log('–í–∫–ª–∞–¥–∫–∏ —Å —á–∞—Å—Ç–æ—Ç–∞–º–∏ —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω—ã');
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –≤–∫–ª–∞–¥–æ–∫ —Å —á–∞—Å—Ç–æ—Ç–∞–º–∏:', error);
            }
        }

        /**
         * –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –¥–ª—è –≤–∫–ª–∞–¥–æ–∫ —Å —á–∞—Å—Ç–æ—Ç–∞–º–∏
         */
        function initializeSubTabs() {
            const subTabs = document.querySelectorAll('.sub-tab');
            subTabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    // –°–Ω–∞—á–∞–ª–∞ —É–¥–∞–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —É –≤—Å–µ—Ö –ø–æ–¥–≤–∫–ª–∞–¥–æ–∫
                    subTabs.forEach(t => t.classList.remove('active'));

                    // –î–æ–±–∞–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å –Ω—É–∂–Ω–æ–π –ø–æ–¥–≤–∫–ª–∞–¥–∫–µ
                    tab.classList.add('active');

                    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–µ–∫—É—â—É—é —á–∞—Å—Ç–æ—Ç—É –∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ
                    state.currentFrequency = tab.getAttribute('data-freq');
                    loadChoicesData();
                });
            });
        }

        // –ò–∑–º–µ–Ω—è–µ–º —Ñ—É–Ω–∫—Ü–∏—é –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã, —á—Ç–æ–±—ã –æ–Ω–∞ –≤—ã–∑—ã–≤–∞–ª–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤–∫–ª–∞–¥–æ–∫ —Å —á–∞—Å—Ç–æ—Ç–∞–º–∏
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –∏ –ø—Ä–∞–≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
                const authResponse = await fetch(`${API_URL}/admin/check`, {
                    credentials: 'include',
                    // –î–æ–±–∞–≤–∏–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è
                    headers: {
                        'Cache-Control': 'no-cache, no-store, must-revalidate',
                        'Pragma': 'no-cache',
                        'Expires': '0',
                    }
                });

                if (!authResponse.ok) {
                    // –ï—Å–ª–∏ –∑–∞–ø—Ä–æ—Å –∑–∞–≤–µ—Ä—à–∏–ª—Å—è —Å –æ—à–∏–±–∫–æ–π, –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤—Ö–æ–¥–∞
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:', authResponse.status);
                    window.location.href = 'index.html';
                    return;
                }

                const authData = await authResponse.json();

                if (!authData.isAdmin) {
                    console.error('–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º');
                    // –î–æ–±–∞–≤–ª—è–µ–º –Ω–µ–±–æ–ª—å—à—É—é –∑–∞–¥–µ—Ä–∂–∫—É –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º
                    setTimeout(() => {
                        window.location.href = 'index.html';
                    }, 100);
                    return;
                }

                console.log('–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–π –¥–æ—Å—Ç—É–ø –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω');

                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤–∫–ª–∞–¥–æ–∫
                initializeTabs();

                // –û–±–Ω–æ–≤–ª—è–µ–º –≤–∫–ª–∞–¥–∫–∏ —Å —á–∞—Å—Ç–æ—Ç–∞–º–∏
                await updateFrequencyTabs();

                // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –ø–µ—Ä–≤–æ–π –∞–∫—Ç–∏–≤–Ω–æ–π –≤–∫–ª–∞–¥–∫–∏ (—Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞)
                loadStatisticsData();

                // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –¥–ª—è –∫–Ω–æ–ø–∫–∏ –≤—ã—Ö–æ–¥–∞
                document.getElementById('logout-btn').addEventListener('click', logout);

                // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω
                initializeModals();

                // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ñ–æ–Ω–æ–≤–æ–≥–æ –∫–æ–¥–∞
                generateBackgroundCode();
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ø–∞–Ω–µ–ª–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞:', error);
                alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –ø–∞–Ω–µ–ª–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞. –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É...');
                window.location.href = 'index.html';
            }
        });

        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —Å–ø–∏—Å–∫–∞ –≤—ã–±–æ—Ä–æ–≤
        function renderChoicesList() {
            const choiceList = document.getElementById('choice-list');
            if (!choiceList) return;

            choiceList.innerHTML = '';

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –¥–∞–Ω–Ω—ã—Ö
            if (!state.choiceStats || state.choiceStats.length === 0) {
                choiceList.innerHTML = '<li class="choice-item">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ –≤—ã–±–æ—Ä–∞—Ö';
                if (document.getElementById('choices-content')) {
                    document.getElementById('choices-content').style.display = 'block';
                }
                return;
            }

            // –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –≤—ã–±–æ—Ä–æ–≤ –ø–æ choiceId –∏ frequency
            const choiceGroups = {};

            state.choiceStats.forEach(stat => {
                // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —á–∞—Å—Ç–æ—Ç–µ, –µ—Å–ª–∏ –≤—ã–±—Ä–∞–Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∞—è —á–∞—Å—Ç–æ—Ç–∞
                if (state.currentFrequency !== 'all' && stat.frequency !== state.currentFrequency) {
                    return;
                }

                const key = `${stat.frequency}-${stat.choice_id}`;

                if (!choiceGroups[key]) {
                    choiceGroups[key] = {
                        frequency: stat.frequency,
                        choiceId: stat.choice_id,
                        total: 0,
                        options: []
                    };
                }

                // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º count –≤ —á–∏—Å–ª–æ –∏ –¥–æ–±–∞–≤–ª—è–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É –Ω–∞ NaN
                const count = parseInt(stat.count);
                choiceGroups[key].total += isNaN(count) ? 0 : count;

                choiceGroups[key].options.push({
                    optionId: stat.option_id,
                    text: stat.choice_text || '–ù–µ—Ç —Ç–µ–∫—Å—Ç–∞',
                    count: isNaN(count) ? 0 : count,
                    users: stat.users ? stat.users.split(',') : []
                });
            });

            // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤ –º–∞—Å—Å–∏–≤ –∏ —Å–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ frequency –∏ choiceId
            const sortedChoices = Object.values(choiceGroups).sort((a, b) => {
                if (a.frequency !== b.frequency) {
                    return a.frequency.localeCompare(b.frequency);
                }
                return a.choiceId.localeCompare(b.choiceId);
            });

            if (sortedChoices.length === 0) {
                choiceList.innerHTML = '<li class="choice-item">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ –≤—ã–±–æ—Ä–∞—Ö –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–π —á–∞—Å—Ç–æ—Ç—ã';
                if (document.getElementById('choices-content')) {
                    document.getElementById('choices-content').style.display = 'block';
                }
                return;
            }

            // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –≤—ã–±–æ—Ä—ã
            sortedChoices.forEach(choice => {
                // [–û—Å—Ç–∞–≤—à–∞—è—Å—è —á–∞—Å—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π]
                // –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º —Å —Å–æ–∑–¥–∞–Ω–∏—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –≤—ã–±–æ—Ä–∞
                const listItem = document.createElement('li');
                listItem.className = 'choice-item';
                listItem.dataset.frequency = choice.frequency;
                listItem.dataset.choiceId = choice.choiceId;

                // –°–æ—Ä—Ç–∏—Ä—É–µ–º –æ–ø—Ü–∏–∏ –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –≤—ã–±–æ—Ä–æ–≤ (–ø–æ —É–±—ã–≤–∞–Ω–∏—é)
                choice.options.sort((a, b) => b.count - a.count);

                // –ó–∞–≥–æ–ª–æ–≤–æ–∫ –≤—ã–±–æ—Ä–∞
                const header = document.createElement('div');
                header.className = 'choice-header';
                header.innerHTML = `
         <div class="choice-title">${choice.frequency}: ${choice.choiceId}
         <div class="choice-count">${choice.total} –≤—ã–±–æ—Ä–æ–≤
         `;
                listItem.appendChild(header);

                // –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –æ–ø—Ü–∏–π
                const optionsContainer = document.createElement('div');
                optionsContainer.className = 'choice-options';

                // –î–æ–±–∞–≤–ª—è–µ–º –∫–∞–∂–¥—ã–π –≤–∞—Ä–∏–∞–Ω—Ç
                choice.options.forEach(option => {
                    const optionDiv = document.createElement('div');
                    optionDiv.className = 'choice-option';

                    // –í—ã—á–∏—Å–ª—è–µ–º –ø—Ä–æ—Ü–µ–Ω—Ç (–∑–∞—â–∏—â–∞–µ–º—Å—è –æ—Ç –¥–µ–ª–µ–Ω–∏—è –Ω–∞ –Ω–æ–ª—å)
                    const percent = choice.total > 0 ? Math.round((option.count / choice.total) * 100) : 0;

                    optionDiv.innerHTML = `
         <div class="choice-option-text">${option.text}
         <div class="choice-option-count">${option.count}
         <div class="choice-option-percent">${percent}%
         `;

                    // –î–æ–±–∞–≤–ª—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä
                    const progressBar = document.createElement('div');
                    progressBar.className = 'progress-bar';

                    const progressValue = document.createElement('div');
                    progressValue.className = 'progress-value';
                    progressValue.style.width = `${percent}%`;

                    progressBar.appendChild(progressValue);
                    optionDiv.appendChild(progressBar);

                    optionsContainer.appendChild(optionDiv);
                });

                listItem.appendChild(optionsContainer);

                // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è —Ä–∞—Å–∫—Ä—ã—Ç–∏—è/—Å–∫—Ä—ã—Ç–∏—è –æ–ø—Ü–∏–π
                listItem.addEventListener('click', function(event) {
                    // –ï—Å–ª–∏ –∫–ª–∏–∫ –±—ã–ª –Ω–µ –Ω–∞ —Å–∞–º–æ–º —ç–ª–µ–º–µ–Ω—Ç–µ, –∞ –Ω–∞ –≤–ª–æ–∂–µ–Ω–Ω–æ–º - –∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º
                    if (event.target !== this && !this.contains(event.target)) {
                        return;
                    }

                    this.classList.toggle('expanded');
                });

                // –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏
                const detailButton = document.createElement('button');
                detailButton.className = 'btn';
                detailButton.textContent = '–î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è';
                detailButton.addEventListener('click', (event) => {
                    event.stopPropagation(); // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º —Ä–∞—Å–∫—Ä—ã—Ç–∏–µ/—Å–∫—Ä—ã—Ç–∏–µ –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ –∫–Ω–æ–ø–∫—É
                    openChoiceDetailsModal(choice.frequency, choice.choiceId);
                });

                listItem.appendChild(detailButton);

                choiceList.appendChild(listItem);
            });

            if (document.getElementById('choices-content')) {
                document.getElementById('choices-content').style.display = 'block';
            }
        }

        // –û—Ç–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ —Å –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–µ–π –≤—ã–±–æ—Ä–∞
        async function openChoiceDetailsModal(frequency, choiceId) {
            const modal = document.getElementById('choice-details-modal');
            if (!modal) return;

            modal.style.display = 'flex';

            const frequencyElement = document.getElementById('detail-frequency');
            const choiceIdElement = document.getElementById('detail-choice-id');

            if (frequencyElement) frequencyElement.textContent = frequency;
            if (choiceIdElement) choiceIdElement.textContent = choiceId;

            const loadingElement = document.getElementById('choice-details-loading');
            const contentElement = document.getElementById('choice-details-content');

            if (loadingElement) loadingElement.style.display = 'flex';
            if (contentElement) contentElement.style.display = 'none';

            try {
                // –°–æ–∑–¥–∞–¥–∏–º –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
                let data = {
                    details: []
                };

                // –ü—ã—Ç–∞–µ–º—Å—è –ø–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ —Å —Å–µ—Ä–≤–µ—Ä–∞ 
                try {
                    const response = await fetch(`${API_URL}/admin/choice-details/${frequency}/${choiceId}`, {
                        credentials: 'include'
                    });

                    if (response.ok) {
                        data = await response.json();
                    } else {
                        console.warn(`–°–µ—Ä–≤–µ—Ä –≤–µ—Ä–Ω—É–ª –æ—à–∏–±–∫—É: ${response.status} ${response.statusText}`);
                        // –ù–µ –≤—ã–±—Ä–∞—Å—ã–≤–∞–µ–º –∏—Å–∫–ª—é—á–µ–Ω–∏–µ, –ø—Ä–æ—Å—Ç–æ –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
                        throw new Error(`–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞: ${response.status} ${response.statusText}`);
                    }
                } catch (fetchError) {
                    throw fetchError; // –ü—Ä–æ–±—Ä–∞—Å—ã–≤–∞–µ–º –∏—Å–∫–ª—é—á–µ–Ω–∏–µ –¥–∞–ª—å—à–µ
                }

                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–∞–Ω–Ω—ã–µ –Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å
                if (!data || !data.details || !Array.isArray(data.details)) {
                    throw new Error('–ü–æ–ª—É—á–µ–Ω—ã –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –æ –¥–µ—Ç–∞–ª—è—Ö –≤—ã–±–æ—Ä–∞');
                }

                renderChoiceDetails(data.details, frequency, choiceId);
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –¥–µ—Ç–∞–ª–µ–π –≤—ã–±–æ—Ä–∞:', error);

                const detailOptions = document.getElementById('detail-options');
                if (detailOptions) {
                    detailOptions.textContent = `–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –¥–µ—Ç–∞–ª–µ–π: ${error.message}`;
                }

                if (loadingElement) loadingElement.style.display = 'none';
                if (contentElement) contentElement.style.display = 'block';
            }
        }

        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –¥–µ—Ç–∞–ª–µ–π –≤—ã–±–æ—Ä–∞ –≤ –º–æ–¥–∞–ª—å–Ω–æ–º –æ–∫–Ω–µ
        function renderChoiceDetails(details, frequency, choiceId) {
            const optionsContainer = document.getElementById('detail-options');
            const usersTable = document.getElementById('detail-users-table');

            optionsContainer.innerHTML = '';
            usersTable.innerHTML = '';

            // –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –¥–µ—Ç–∞–ª–∏ –ø–æ –≤–∞—Ä–∏–∞–Ω—Ç–∞–º
            const optionGroups = {};
            details.forEach(detail => {
                if (!optionGroups[detail.option_id]) {
                    optionGroups[detail.option_id] = {
                        optionId: detail.option_id,
                        text: detail.choice_text,
                        users: [],
                        count: 0
                    };
                }

                optionGroups[detail.option_id].users.push({
                    username: detail.username,
                    createdAt: detail.created_at
                });
                optionGroups[detail.option_id].count++;
            });

            // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤ –º–∞—Å—Å–∏–≤ –∏ —Å–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É
            const sortedOptions = Object.values(optionGroups).sort((a, b) => b.count - a.count);

            // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –≤–∞—Ä–∏–∞–Ω—Ç—ã
            sortedOptions.forEach(option => {
                const optionText = document.createElement('div');
                optionText.innerHTML = `<strong>${option.text} (${option.count} –≤—ã–±–æ—Ä–æ–≤)`;
                optionsContainer.appendChild(optionText);
            });

            // –°–æ–∑–¥–∞–µ–º –∫—Ä—É–≥–æ–≤—É—é –¥–∏–∞–≥—Ä–∞–º–º—É
            createDetailChart(sortedOptions);

            // –ó–∞–ø–æ–ª–Ω—è–µ–º —Ç–∞–±–ª–∏—Ü—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
            details.forEach(detail => {
                const row = document.createElement('tr');

                // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –¥–∞—Ç—É
                const createdAt = new Date(detail.created_at);
                const formattedDate = `${createdAt.toLocaleDateString()} ${createdAt.toLocaleTimeString()}`;

                row.innerHTML = `
         <td>${detail.username}
         <td>${detail.choice_text}
         <td>${formattedDate}
         `;

                usersTable.appendChild(row);
            });

            document.getElementById('choice-details-loading').style.display = 'none';
            document.getElementById('choice-details-content').style.display = 'block';
        }

        // –°–æ–∑–¥–∞–µ—Ç –∫—Ä—É–≥–æ–≤—É—é –¥–∏–∞–≥—Ä–∞–º–º—É –¥–ª—è –¥–µ—Ç–∞–ª–µ–π –≤—ã–±–æ—Ä–∞
        function createDetailChart(options) {
            const ctx = document.getElementById('detail-chart').getContext('2d');

            if (state.charts.detailChart) {
                state.charts.detailChart.destroy();
            }

            const labels = options.map(option => `${option.text}`);
            const data = options.map(option => option.count);
            const colors = options.map((_, index) => {
                const hue = (index * 137.5) % 360; // –ò—Å–ø–æ–ª—å–∑—É–µ–º –∑–æ–ª–æ—Ç–æ–µ —Å–µ—á–µ–Ω–∏–µ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ü–≤–µ—Ç–æ–≤
                return `hsla(${hue}, 80%, 60%, 0.7)`;
            });

            state.charts.detailChart = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: labels,
                    datasets: [{
                        data: data,
                        backgroundColor: colors,
                        borderColor: colors.map(color => color.replace('0.7', '1')),
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right',
                            labels: {
                                color: '#03FB8D',
                                font: {
                                    size: 12
                                }
                            }
                        },
                        title: {
                            display: true,
                            text: '–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç–æ–≤',
                            color: '#03FB8D'
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = context.raw;
                                    const percent = Math.round((value / context.dataset.data.reduce((a, b) => a + b, 0)) * 100);
                                    return `${label}: ${value} (${percent}%)`;
                                }
                            }
                        }
                    }
                }
            });
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –æ –ø—Ä–æ–≥—Ä–µ—Å—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π 
        async function loadProgressData() {
            const loadingElement = document.getElementById('progress-loading');
            const contentElement = document.getElementById('progress-content');
            const tableBody = document.getElementById('progress-table-body');

            if (loadingElement && contentElement) {
                loadingElement.style.display = 'flex';
                contentElement.style.display = 'none';
            }

            try {
                console.log('–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –æ –ø—Ä–æ–≥—Ä–µ—Å—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π...');

                const data = await safeFetch(`${API_URL}/admin/user-progress`);

                if (!data || !data.progress || !Array.isArray(data.progress)) {
                    throw new Error('–ü–æ–ª—É—á–µ–Ω—ã –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –æ –ø—Ä–æ–≥—Ä–µ—Å—Å–µ');
                }

                console.log(`–í—Å–µ–≥–æ –ø–æ–ª—É—á–µ–Ω–æ –∑–∞–ø–∏—Å–µ–π –æ –ø—Ä–æ–≥—Ä–µ—Å—Å–µ: ${data.progress.length}`);
                state.progressData = data.progress;

                renderProgressData();

                if (loadingElement && contentElement) {
                    loadingElement.style.display = 'none';
                    contentElement.style.display = 'block';
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –¥–∞–Ω–Ω—ã—Ö –æ –ø—Ä–æ–≥—Ä–µ—Å—Å–µ:', error);

                // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
                state.progressData = [];

                if (loadingElement) {
                    loadingElement.style.display = 'none';
                }

                if (contentElement) {
                    contentElement.style.display = 'block';
                }

                if (tableBody) {
                    tableBody.innerHTML = '<tr><td colspan="4" class="text-center">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ –ø—Ä–æ–≥—Ä–µ—Å—Å–µ. –í–æ–∑–º–æ–∂–Ω–æ, —Å–µ—Ä–≤–µ—Ä –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω.';
                }

                // –û—á–∏—â–∞–µ–º –≥—Ä–∞—Ñ–∏–∫
                const chartCanvas = document.getElementById('progress-chart');
                if (chartCanvas) {
                    if (state.charts.progressChart) {
                        state.charts.progressChart.destroy();
                        state.charts.progressChart = null;
                    }
                    const ctx = chartCanvas.getContext('2d');
                    if (ctx) {
                        ctx.clearRect(0, 0, chartCanvas.width, chartCanvas.height);
                    }
                    chartCanvas.innerHTML = '<div class="no-data">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è';
                }

                showErrorMessage('progress-content', `–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –æ –ø—Ä–æ–≥—Ä–µ—Å—Å–µ: ${error.message}`);
            }
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ –¥–∏–∞–≥—Ä–∞–º–º—ã –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
        function createProgressChart() {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏ canvas —ç–ª–µ–º–µ–Ω—Ç–∞
            if (!state.progressData || state.progressData.length === 0) {
                console.log('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –≥—Ä–∞—Ñ–∏–∫–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞');
                const chartCanvas = document.getElementById('progress-chart');
                if (chartCanvas) {
                    chartCanvas.innerHTML = '<div class="no-data">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è';
                }
                return;
            }

            const chartCanvas = document.getElementById('progress-chart');
            if (!chartCanvas) {
                console.warn('–≠–ª–µ–º–µ–Ω—Ç canvas –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω');
                return;
            }

            console.log('–°–æ–∑–¥–∞–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–∞–Ω–Ω—ã—Ö:', state.progressData);

            // –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å –ø–æ —á–∞—Å—Ç–æ—Ç–∞–º
            const frequencyGroups = {};

            state.progressData.forEach(progress => {
                if (!progress.frequency) {
                    console.warn('–û–±–Ω–∞—Ä—É–∂–µ–Ω–∞ –∑–∞–ø–∏—Å—å –±–µ–∑ —É–∫–∞–∑–∞–Ω–∏—è —á–∞—Å—Ç–æ—Ç—ã:', progress);
                    return; // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –∑–∞–ø–∏—Å–∏ –±–µ–∑ —á–∞—Å—Ç–æ—Ç—ã
                }

                if (!frequencyGroups[progress.frequency]) {
                    frequencyGroups[progress.frequency] = {
                        totalUsers: 0,
                        completed: 0,
                        inProgress: 0
                    };
                }

                frequencyGroups[progress.frequency].totalUsers++;

                if (progress.completed) {
                    frequencyGroups[progress.frequency].completed++;
                } else {
                    frequencyGroups[progress.frequency].inProgress++;
                }
            });

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –¥–∞–Ω–Ω—ã–µ –ø–æ—Å–ª–µ –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏
            if (Object.keys(frequencyGroups).length === 0) {
                console.warn('–ü–æ—Å–ª–µ –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏ –Ω–µ –æ—Å—Ç–∞–ª–æ—Å—å –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–∞');
                chartCanvas.innerHTML = '<div class="no-data">–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è';
                return;
            }

            console.log('–°–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–∞:', frequencyGroups);

            // –ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–∞
            const labels = Object.keys(frequencyGroups);
            const completedData = labels.map(freq => frequencyGroups[freq].completed);
            const inProgressData = labels.map(freq => frequencyGroups[freq].inProgress);

            // –ï—Å–ª–∏ —É–∂–µ –µ—Å—Ç—å –≥—Ä–∞—Ñ–∏–∫, —É–Ω–∏—á—Ç–æ–∂–∞–µ–º –µ–≥–æ –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º –Ω–æ–≤–æ–≥–æ
            if (state.charts.progressChart) {
                state.charts.progressChart.destroy();
            }

            // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π –≥—Ä–∞—Ñ–∏–∫
            const ctx = chartCanvas.getContext('2d');

            state.charts.progressChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                            label: '–ó–∞–≤–µ—Ä—à–µ–Ω–æ',
                            data: completedData,
                            backgroundColor: 'rgba(3, 251, 141, 0.7)',
                            borderColor: 'rgba(3, 251, 141, 1)',
                            borderWidth: 1
                        },
                        {
                            label: '–í –ø—Ä–æ—Ü–µ—Å—Å–µ',
                            data: inProgressData,
                            backgroundColor: 'rgba(75, 192, 192, 0.7)',
                            borderColor: 'rgba(75, 192, 192, 1)',
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            stacked: true,
                            title: {
                                display: true,
                                text: '–ß–∞—Å—Ç–æ—Ç–∞',
                                color: '#03FB8D'
                            },
                            ticks: {
                                color: '#03FB8D'
                            },
                            grid: {
                                color: 'rgba(3, 251, 141, 0.1)'
                            }
                        },
                        y: {
                            stacked: true,
                            title: {
                                display: true,
                                text: '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π',
                                color: '#03FB8D'
                            },
                            ticks: {
                                color: '#03FB8D',
                                beginAtZero: true,
                                stepSize: 1
                            },
                            grid: {
                                color: 'rgba(3, 251, 141, 0.1)'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            labels: {
                                color: '#03FB8D'
                            }
                        },
                        title: {
                            display: true,
                            text: '–ü—Ä–æ–≥—Ä–µ—Å—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–æ —á–∞—Å—Ç–æ—Ç–∞–º',
                            color: '#03FB8D'
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.dataset.label || '';
                                    const value = context.raw;
                                    return `${label}: ${value} –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π`;
                                }
                            }
                        }
                    }
                }
            });

            console.log('–ì—Ä–∞—Ñ–∏–∫ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω');
        }

        /**
         * –û–±—ë—Ä—Ç–∫–∞ –Ω–∞–¥ fetch —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º
         * @param {string} url - URL –∑–∞–ø—Ä–æ—Å–∞
         * @param {object} options - –æ–ø—Ü–∏–∏ fetch
         * @returns {Promise<any>} - –æ—Ç–≤–µ—Ç –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON
         */
        async function safeFetch(url, options = {}) {
            console.log(`–í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –∑–∞–ø—Ä–æ—Å –∫: ${url}`, options);

            try {
                // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≥–æ–ª–æ–≤–∫–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, –µ—Å–ª–∏ –æ–Ω–∏ –Ω–µ —É–∫–∞–∑–∞–Ω—ã
                if (!options.headers) {
                    options.headers = {
                        'Cache-Control': 'no-cache, no-store, must-revalidate',
                        'Pragma': 'no-cache',
                        'Expires': '0'
                    };
                }

                // –î–æ–±–∞–≤–ª—è–µ–º credentials, –µ—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω—ã
                if (!options.credentials) {
                    options.credentials = 'include';
                }

                // –í—ã–ø–æ–ª–Ω—è–µ–º –∑–∞–ø—Ä–æ—Å
                const response = await fetch(url, options);

                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å –æ—Ç–≤–µ—Ç–∞
                if (!response.ok) {
                    // –ü—ã—Ç–∞–µ–º—Å—è –ø–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—Å—Ç –æ—à–∏–±–∫–∏
                    let errorText = '';
                    try {
                        errorText = await response.text();
                    } catch (e) {
                        errorText = '–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—Å—Ç –æ—à–∏–±–∫–∏';
                    }

                    console.error(`–û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –∫ ${url}: ${response.status} ${response.statusText}`, errorText);
                    throw new Error(`–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞: ${response.status} ${response.statusText}`);
                }

                // –ü–∞—Ä—Å–∏–º JSON-–æ—Ç–≤–µ—Ç
                const data = await response.json();
                console.log(`–£—Å–ø–µ—à–Ω—ã–π –æ—Ç–≤–µ—Ç –æ—Ç ${url}:`, data);
                return data;
            } catch (error) {
                console.error(`–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –∑–∞–ø—Ä–æ—Å–∞ –∫ ${url}:`, error);
                throw error;
            }
        }

        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –æ –ø—Ä–æ–≥—Ä–µ—Å—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
        function renderProgressData() {
            const tableBody = document.getElementById('progress-table-body');

            if (!tableBody) return;

            tableBody.innerHTML = '';

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –¥–∞–Ω–Ω—ã—Ö
            if (!state.progressData || state.progressData.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="4" class="text-center">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ –ø—Ä–æ–≥—Ä–µ—Å—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π';

                // –û—á–∏—â–∞–µ–º –≥—Ä–∞—Ñ–∏–∫
                const chartCanvas = document.getElementById('progress-chart');
                if (chartCanvas) {
                    if (state.charts.progressChart) {
                        state.charts.progressChart.destroy();
                        state.charts.progressChart = null;
                    }
                    const ctx = chartCanvas.getContext('2d');
                    if (ctx) {
                        ctx.clearRect(0, 0, chartCanvas.width, chartCanvas.height);
                    }
                    chartCanvas.innerHTML = '<div class="no-data">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è';
                }

                return;
            }

            console.log(`–û—Ç—Ä–∏—Å–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –æ –ø—Ä–æ–≥—Ä–µ—Å—Å–µ: ${state.progressData.length} –∑–∞–ø–∏—Å–µ–π`);

            // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –∏ —á–∞—Å—Ç–æ—Ç–µ
            const sortedProgress = [...state.progressData].sort((a, b) => {
                if (a.username !== b.username) {
                    return a.username.localeCompare(b.username);
                }
                return a.frequency.localeCompare(b.frequency);
            });

            // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —Ç–∞–±–ª–∏—Ü—ã
            sortedProgress.forEach(progress => {
                const row = document.createElement('tr');

                // –ü–æ–ª—É—á–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
                // –ï—Å–ª–∏ progress.progress - —ç—Ç–æ —Å—Ç—Ä–æ–∫–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, "50 –∏–∑ 100"), –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –µ—ë –≤ —á–∏—Å–ª–æ
                // –ü–æ–ª—É—á–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
                let progressPercent = 0;

                if (typeof progress.progress === 'number') {
                    // –ï—Å–ª–∏ —ç—Ç–æ —á–∏—Å–ª–æ –æ—Ç 0 –¥–æ 100, –∏—Å–ø–æ–ª—å–∑—É–µ–º –∫–∞–∫ –µ—Å—Ç—å
                    progressPercent = progress.progress;
                } else if (typeof progress.progress === 'string') {
                    // –ï—Å–ª–∏ —ç—Ç–æ —Å—Ç—Ä–æ–∫–∞, –ø—ã—Ç–∞–µ–º—Å—è –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å –≤ —á–∏—Å–ª–æ
                    // –ù–∞–ø—Ä–∏–º–µ—Ä, "50 –∏–∑ 100" -> 50
                    const match = progress.progress.match(/(\d+)/);
                    if (match && match[1]) {
                        progressPercent = parseInt(match[1]);
                    }

                    // –ï—Å–ª–∏ —Å—Ç—Ä–æ–∫–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç –ø—Ä–æ—Ü–µ–Ω—Ç –∏–ª–∏ —á–∞—Å—Ç—å, —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ
                    if (progress.progress.includes('/') || progress.progress.includes(' –∏–∑ ')) {
                        const parts = progress.progress.split(/[ \/]/);
                        const current = parseInt(parts[0]);
                        const total = parseInt(parts[parts.length - 1]);
                        if (!isNaN(current) && !isNaN(total) && total > 0) {
                            progressPercent = Math.round((current / total) * 100);
                        }
                    }
                }

                // –£–±–µ–¥–∏–º—Å—è, —á—Ç–æ –∑–Ω–∞—á–µ–Ω–∏–µ –≤ –¥–æ–ø—É—Å—Ç–∏–º–æ–º –¥–∏–∞–ø–∞–∑–æ–Ω–µ
                progressPercent = Math.max(0, Math.min(100, progressPercent));

                console.log(`–ü—Ä–æ–≥—Ä–µ—Å—Å –¥–ª—è ${progress.username} (${progress.frequency}): ${progress.progress} -> ${progressPercent}%`);

                row.innerHTML = `
         <td>${progress.username}
         <td>${progress.frequency}
         <td>
         <div style="width: 100%; background: rgba(3, 251, 141, 0.1); height: 10px;">
         <div style="width: ${progressPercent}%; background: #03FB8D; height: 100%;">
         
         <div style="text-align: center; margin-top: 5px;">${progressPercent}% (${progress.progress || '0'})
         
         <td>${progress.completed ? '–î–∞' : '–ù–µ—Ç'}
         `;

                tableBody.appendChild(row);
            });

            // –°–æ–∑–¥–∞–µ–º –¥–∏–∞–≥—Ä–∞–º–º—É –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
            try {
                createProgressChart();
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –≥—Ä–∞—Ñ–∏–∫–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞:', error);

                const chartCanvas = document.getElementById('progress-chart');
                if (chartCanvas) {
                    chartCanvas.innerHTML = '<div class="no-data">–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –≥—Ä–∞—Ñ–∏–∫–∞';
                }
            }

            if (document.getElementById('progress-content')) {
                document.getElementById('progress-content').style.display = 'block';
            }
        }

        // –í—ã—Ö–æ–¥ –∏–∑ —Å–∏—Å—Ç–µ–º—ã
        async function logout() {
            try {
                await fetch(`${API_URL}/auth/logout`, {
                    method: 'POST',
                    credentials: 'include'
                });

                // –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤—Ö–æ–¥–∞
                window.location.href = 'index.html';
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ –∏–∑ —Å–∏—Å—Ç–µ–º—ã:', error);
                alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ –∏–∑ —Å–∏—Å—Ç–µ–º—ã. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.');
            }
        }

        // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

        // –ü–æ–∫–∞–∑–∞—Ç—å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
        function showLoading(tabId) {
            const loadingElement = document.getElementById(`${tabId}-loading`);
            const contentElement = document.getElementById(`${tabId}-content`);

            if (loadingElement) {
                loadingElement.style.display = 'flex';
            }

            if (contentElement) {
                contentElement.style.display = 'none';
            }
        }

        // –°–∫—Ä—ã—Ç—å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
        function hideLoading(tabId) {
            const loadingElement = document.getElementById(`${tabId}-loading`);
            const contentElement = document.getElementById(`${tabId}-content`);

            if (loadingElement) {
                loadingElement.style.display = 'none';
            }

            if (contentElement) {
                contentElement.style.display = 'block';
            }
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
        function showErrorMessage(elementId, message) {
            const element = document.getElementById(elementId);

            const errorDiv = document.createElement('div');
            errorDiv.className = 'alert alert-danger';
            errorDiv.textContent = message;

            element.innerHTML = '';
            element.appendChild(errorDiv);
            element.style.display = 'block';

            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∫—Ä—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
            setTimeout(() => {
                errorDiv.style.display = 'none';
            }, 5000);
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—Ö–µ
        function showSuccessMessage(elementId, message) {
            const element = document.getElementById(elementId);

            const successDiv = document.createElement('div');
            successDiv.className = 'alert alert-success';
            successDiv.textContent = message;

            // –í—Å—Ç–∞–≤–ª—è–µ–º –ø–µ—Ä–µ–¥ —ç–ª–µ–º–µ–Ω—Ç–æ–º
            element.parentNode.insertBefore(successDiv, element);

            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∫—Ä—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
            setTimeout(() => {
                successDiv.remove();
            }, 5000);
        }

        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ñ–æ–Ω–æ–≤–æ–≥–æ "–∫–æ–¥–∞" –¥–ª—è –∫–∏–±–µ—Ä–ø–∞–Ω–∫-—Å—Ç–∏–ª—è
        function generateBackgroundCode() {
            const bgElement = document.getElementById('bgCode');

            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å—Ç—Ä–æ–∫–∏ "–∫–æ–¥–∞"
            const codeStrings = [
                "function initGMS4521() { return { status: 'ACTIVE', secLevel: 'ALPHA-7' }; }",
                "const terminalAccess = new SecurityProtocol('ADMIN', 0x7F);",
                "if (securityBreached) { initCountermeasures(PROTOCOL.OMEGA); }",
                "class DataStream extends BinaryProtocol { constructor() { super(0x8F); } }",
                "await terminal.connect('/dev/tty0', { encrypted: true });",
                "for (let i = 0; i < dataNodes.length; i++) { validate(dataNodes[i]); }",
                "const encryptionLevel = LEVEL.MAXIMUM; // Required for GMS access",
                "function parseIncomingSignals(data) { return new Transmission(data); }",
                "encryption.applyKey(generateRandomBytes(32));",
                "while (terminal.active) { terminal.processCommands(); }",
                "const vulnerabilities = system.scanForThreats();",
                "if (userAccess.level < 7) { throw new SecurityException(); }",
                "terminal.display('–ê–ö–¢–ò–í–ò–†–û–í–ê–ù –ü–†–û–¢–û–ö–û–õ –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–ò GMS-4521');",
                "for (const node of network.activeNodes) { ping(node.address); }",
                "const userAccessLevel = authentication.validateCredentials(user);",
                "async function establishSecureConnection() { /* ... */ }",
                "if (signal.strength < MIN_THRESHOLD) { boost(signal); }",
                "mainframe.execute(COMMAND.SYSTEM_SCAN, { priority: HIGH });",
                "try { connectToSatellite(); } catch (e) { useBackupLink(); }",
                "const encryptedMessage = encode(message, KEY.SECRET);",
                "dataTransmission.start({ protocol: 'QUANTUM', packetSize: 1024 });",
                "function detectIntrusion(logs) { return logs.filter(isAnomaly); }",
                "const securityStatus = terminal.checkPerimeterSystems();",
                "const dataChannels = network.getSecureChannels().filter(isActive);",
                "if (DEFCON_LEVEL === 1) { initEmergencyProtocols(); }"
            ];

            // –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç—Ä–æ–∫–∏ "–∫–æ–¥–∞" –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å —Ä–∞–∑–Ω—ã–º —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ–º
            for (let i = 0; i < 50; i++) {
                const codeLine = document.createElement('div');
                codeLine.className = 'code-line';

                // –°–ª—É—á–∞–π–Ω–∞—è —Å—Ç—Ä–æ–∫–∞ –∏–∑ –Ω–∞–±–æ—Ä–∞
                codeLine.textContent = codeStrings[Math.floor(Math.random() * codeStrings.length)];

                // –°–ª—É—á–∞–π–Ω–æ–µ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ
                codeLine.style.left = `${Math.random() * 100}%`;

                // –°–ª—É—á–∞–π–Ω–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å –∞–Ω–∏–º–∞—Ü–∏–∏ (–æ—Ç 10 –¥–æ 30 —Å–µ–∫—É–Ω–¥)
                const duration = 10 + Math.random() * 20;
                codeLine.style.animationDuration = `${duration}s`;

                // –°–ª—É—á–∞–π–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –Ω–∞—á–∞–ª–∞ –∞–Ω–∏–º–∞—Ü–∏–∏
                codeLine.style.animationDelay = `${Math.random() * 10}s`;

                bgElement.appendChild(codeLine);
            }
        }
    </script>
</body>

</html>